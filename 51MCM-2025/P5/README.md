# P5问题求解说明

## 问题描述

在某些时间段内，各支路的车流量具有特定函数变化趋势。因此无需在每个时刻都进行监测，只需在一些关键时刻记录车流量数据，就能够推断出整个时间段内各支路的车流量函数表达式。

基于问题2和问题3，我们建立了数学模型，用于确定主路上的监测设备至少需要在[6:58,8:58]时间段内的哪些时刻记录车流量数据，以获得各支路的函数表达式。

## 使用方法

### P2问题的P5求解

```bash
python P2.py --p5 [--method METHOD]
```

### P3问题的P5求解

```bash
python P3.py --p5 [--method METHOD]
```

### 参数说明

- `--p5`: 启用P5问题求解（关键采样点分析）
- `--method`: 采样点识别方法，可选值：
  - `derivative`: 基于导数变化识别关键点
  - `peaks`: 基于峰值和谷值检测关键点
  - `breakpoints`: 基于模型转折点识别关键点
  - `combined`: 结合以上所有方法（默认）

## 输出结果

执行P5求解后，程序会生成以下输出：

1. 控制台输出：
   - 关键采样点数量
   - 采样点时间索引
   - 采样点时间值

2. 文件输出（保存在`./P5/P2/`或`./P5/P3/`目录）：
   - `关键采样点分析.png`: 可视化采样点及其评估结果
   - `关键采样点分析报告.md`: 详细的分析报告，包括：
     - 关键采样点列表（时间索引、时间点、流量值）
     - 评估指标（拟合误差、参数差异等）
     - 结论和分析

## 关键采样点识别方法

本实现使用了多种方法来识别关键采样点：

1. **基于导数变化**：检测流量变化率显著变化的点，这些点通常代表函数形态的转折处。

2. **基于峰值和谷值**：检测流量的局部最大值和最小值，这些点是函数的极值点。

3. **基于模型转折点**：根据已知的模型结构，直接识别函数表达式中的转折点。
   - P2模型：支路2在t=24和t=37有转折点，支路3在t≈40有转折点
   - P3模型：支路1有4个转折点，支路2有2个转折点，支路3在绿灯周期的开始和结束处有转折点

4. **组合方法**：结合以上所有方法，确保捕获所有关键特征点。

## 评估方法

为了评估采样点的有效性，我们比较了使用全部数据点和仅使用采样点拟合的模型参数差异：

1. **参数差异**：计算全部数据拟合参数与采样点拟合参数的平均绝对差异。

2. **拟合误差比**：比较采样点拟合模型与全部数据拟合模型的误差比率。

3. **数据范围覆盖率**：评估采样点是否覆盖了数据的整体范围。

4. **变化点覆盖率**：评估采样点是否覆盖了数据的主要变化点。

## 结论

通过分析，我们确定了一组关键采样点，这些点能够有效地捕捉流量变化特征，使用这些采样点可以推断出整个时间段内各支路的车流量函数表达式，大大减少了数据采集的工作量。