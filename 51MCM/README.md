# 51MCM - 交通流量分析系统

这是51MCM数学建模竞赛的解决方案，主要解决了与交通流量分析相关的一系列问题。

## 项目结构

```
51MCM/
├── 2025-51MCM-Problem A/        # 原始题目和数据
├── P1/                          # 问题1的结果输出目录
├── P2/                          # 问题2的结果输出目录
├── P3/                          # 问题3的结果输出目录
├── P4/                          # 问题4的结果输出目录
├── P5/                          # 问题5的结果输出目录
├── P1.py                        # 问题1的解决方案
├── P2.py                        # 问题2的解决方案
├── p3.py                        # 问题3的解决方案
├── p4.py                        # 问题4的解决方案
├── run_all.py                   # 统一运行脚本
└── README.md                    # 项目说明文档
```

## 运行方式

您可以使用以下命令运行所有问题的解决方案：

```bash
python run_all.py
```

您也可以选择运行特定的问题：

```bash
python run_all.py --problems 1 2  # 只运行问题1和问题2
python run_all.py --skip 4 5      # 跳过问题4和问题5
```

对于问题5，您可以指定采样点识别方法：

```bash
python run_all.py --problems 5 --method derivative  # 使用导数变化方法识别采样点
```

可用的采样点识别方法有：
- `derivative`: 基于导数变化
- `peaks`: 基于峰值检测
- `breakpoints`: 基于模型转折点
- `combined`: 结合以上所有方法（默认）

## 问题概述与解决思路

### 问题1

**概述**：分析主路3的车流量数据，建立数学模型描述支路1和支路2的车流量随时间的变化。

**解决思路**：
- 支路1采用线性增长模型：$f_1(t) = a_1 \cdot t + b_1$
- 支路2采用分段线性模型，在转折点t0处变化：$f_2(t) = \begin{cases} a_2 \cdot t + b_2, & t < t_0 \\ c_2 \cdot t + d_2, & t \geq t_0 \end{cases}$
- 使用优化算法（L-BFGS-B, SLSQP, TNC）寻找最优参数，最小化均方误差
- 添加惩罚项确保模型符合物理约束（非负流量、连续性等）

### 问题2

**概述**：分析主路5的车流量数据，建立数学模型描述四个支路的车流量随时间的变化。

**解决思路**：
- 支路1采用常数模型：$f_1(t) = C_1$
- 支路2采用三段式模型（增长-稳定-下降）
- 支路3采用两段式模型（增长-稳定）
- 支路4采用傅里叶级数模型捕捉周期性变化
- 考虑支路1和支路2的行驶延迟（2分钟）
- 使用粒子群优化（PSO）进行全局搜索，再用L-BFGS-B进行局部精细优化

### 问题3

**概述**：分析主路4的车流量数据，考虑交通信号灯的影响，建立数学模型描述三个支路的车流量随时间的变化。

**解决思路**：
- 支路1采用分段线性模型（共五段）
- 支路2采用三段式模型（增长-稳定-变化）
- 支路3仅在绿灯时段有流量，每个绿灯周期用线性模型描述
- 模拟红绿灯控制逻辑，红灯8分钟，绿灯10分钟
- 考虑支路1和支路2的行驶延迟（2分钟）
- 采用多阶段、多起点优化策略，使用不同优化方法综合求解

### 问题4

**概述**：分析主路4的车流量数据（存在异常值），考虑交通信号灯周期未知的情况，建立数学模型描述三个支路的车流量随时间的变化。

**解决思路**：
- 数据预处理：结合多种方法（移动窗口Z-score、MAD等）检测和修正异常值
- 将第一个绿灯开始时间作为额外的优化参数
- 支路流量模型与问题3类似，但添加更多约束确保模型稳健性
- F使用自适应损失函数，对不同误差区域使用不同权重
- 采用三阶段优化策略：粗略搜索、细化最优解、最终精细调整

### 问题5

**概述**：确定监测设备需要在哪些关键时刻记录数据，以便推断出整个时间段内各支路的车流量函数表达式。

**解决思路**：
- 基于问题2和问题3的模型，分析流量变化的关键特征点
- 结合多种采样点识别方法：
  - 导数变化法：检测流量变化率显著变化的点
  - 峰值检测法：识别流量峰值和谷值
  - 转折点法：基于模型转折点确定关键采样时刻
- 评估采样点的有效性：利用仅采样点的数据拟合模型，与全数据拟合结果比较
- 通过削减采样点数量的敏感性分析，确定最小必要采样集

## 项目特点

1. **统一的代码风格**：所有问题解决方案采用面向对象的设计方式，代码结构清晰统一
2. **多阶段优化策略**：结合全局搜索和局部精细优化，提高参数估计精度
3. **鲁棒的约束处理**：使用惩罚函数确保模型符合物理和问题约束
4. **丰富的可视化分析**：每个问题生成多种图表直观展示结果和误差分析
5. **详细的结果报告**：自动生成Markdown格式的分析报告，包含参数、公式、误差和结论

## 技术栈

- Python 3.8+
- NumPy, SciPy, Pandas: 数据处理和科学计算
- Matplotlib: 数据可视化
- PySwarm: 粒子群优化算法

## 作者

AI学习小组 - 51MCM挑战团队

## 许可证

MIT